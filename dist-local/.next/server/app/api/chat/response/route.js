(()=>{var e={};e.id=886,e.ids=[886],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9523:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>w,routeModule:()=>g,serverHooks:()=>x,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>v});var r={};t.r(r),t.d(r,{POST:()=>u,PUT:()=>c,addMessageToConversation:()=>l,createConversation:()=>d,getConversation:()=>f});var o=t(6559),n=t(8088),a=t(7719),i=t(2190);let p=new Map;async function u(e){try{let s=await e.json();if(!s.conversationId||!s.staffMessage)return i.NextResponse.json({success:!1,error:"Missing required fields"},{status:400});let t=p.get(s.conversationId);if(!t)return i.NextResponse.json({success:!1,error:"Conversation not found"},{status:404});let r={id:`staff-${Date.now()}`,text:s.staffMessage,isUser:!1,timestamp:s.timestamp||new Date().toISOString(),sender:s.staffName||"Vipercam Support"};return t.messages.push(r),t.lastActivity=new Date,console.log(`Staff response added to conversation ${s.conversationId}:`,{message:s.staffMessage.substring(0,100)+"...",staffName:s.staffName,timestamp:r.timestamp}),i.NextResponse.json({success:!0,message:"Staff response sent to customer",conversationId:s.conversationId,messageId:r.id})}catch(e){return console.error("Error processing staff response:",e),i.NextResponse.json({success:!1,error:"Failed to process staff response"},{status:500})}}async function c(e){try{let{conversationId:s,message:t,sender:r}=await e.json();if(!s||!t)return i.NextResponse.json({success:!1,error:"Missing required fields"},{status:400});return new Date().toISOString(),await u(e)}catch(e){return console.error("Error processing webhook response:",e),i.NextResponse.json({success:!1,error:"Failed to process webhook"},{status:500})}}function d(e,s){p.set(e,{customerId:s,lastActivity:new Date,messages:[]})}function f(e){return p.get(e)}function l(e,s){let t=p.get(e);t&&(t.messages.push(s),t.lastActivity=new Date)}let g=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/chat/response/route",pathname:"/api/chat/response",filename:"route",bundlePath:"app/api/chat/response/route"},resolvedPagePath:"G:\\My Downloads\\Vipercam Website\\app\\api\\chat\\response\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:v,serverHooks:x}=g;function w(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:v})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[447,580],()=>t(9523));module.exports=r})();